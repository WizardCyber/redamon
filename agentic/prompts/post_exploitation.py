"""
RedAmon Post-Exploitation Prompts

Prompts for post-exploitation phase with different session types.
"""


# =============================================================================
# POST-EXPLOITATION TOOLS (Statefull Mode - Meterpreter or Shell session)
# =============================================================================

POST_EXPLOITATION_TOOLS_STATEFULL = """
### Post-Exploitation Phase Tools (Statefull Mode)

You have an active Metasploit session. Use `metasploit_console` for all session interactions.

## Detect Your Session Type

Run `sessions -l` — the **Type** column tells you what you have:

| Type | Prompt | Commands |
|------|--------|----------|
| `meterpreter` | `meterpreter >` | Meterpreter commands (sysinfo, upload, migrate...) |
| `shell` / `command` | `$` or `#` | Standard Linux/Windows shell commands |

**Use the right commands for your session type.** Meterpreter commands fail in shell sessions and vice versa.

## Session Management (from msf6 > console)

```
sessions -l           -> List sessions (check type!)
sessions -i <id>      -> Enter session
background            -> Return to msf console (Meterpreter ONLY)
exit                  -> Return to msf console (shell sessions)
sessions -u <id>      -> Upgrade shell to Meterpreter (may fail on minimal systems)
sessions -k <id>      -> Kill session
```

## If Meterpreter Session

**Meterpreter-exclusive commands** (NOT available in shell):

| Command | Purpose |
|---------|---------|
| `sysinfo` | System info |
| `getuid` | Current user |
| `upload local remote` | File transfer to target |
| `download /path` | File transfer from target |
| `migrate <PID>` | Move to another process |
| `hashdump` | Dump password hashes (Windows) |
| `getsystem` | Privilege escalation (Windows) |
| `portfwd add -l P -p P -r host` | Port forwarding |
| `run post/multi/gather/...` | Post-exploitation modules |

**NOT in Meterpreter:** `echo`, `grep`, `awk`, `sed`, `chmod` -> drop to `shell` command first.

**stdapi failure** (`stdapi_fs_*: Operation failed`): Don't retry. Drop to `shell` immediately.

## If Shell Session

Standard Linux/Windows shell. **DO NOT use Meterpreter commands** — they will fail.

Key post-exploitation commands:
```
whoami && id                    -> Current user and groups
uname -a                        -> Kernel and OS info
cat /etc/passwd                 -> List users
cat /etc/shadow                 -> Password hashes (if root)
sudo -l                         -> Check sudo permissions
ps aux                          -> Running processes
netstat -tulpn / ss -tulpn      -> Network connections
find / -perm -4000 2>/dev/null  -> SUID binaries
ip addr && ip route             -> Network interfaces and routing
cat /etc/os-release             -> OS version (for kernel exploits)
getcap -r / 2>/dev/null         -> Files with capabilities
```

## Pivoting (from msf6 console, not inside session)

```
route add <subnet> <session-id>     -> Route traffic through compromised host
# Example: route add 10.0.0.0/24 1
```

## Complementary Tools (run on YOUR Kali box, not on target)

| Tool | Use For |
|------|---------|
| `web_search` | Research kernel exploits, privesc techniques, GTFOBins |
| `query_graph` | Check recon data for lateral movement targets |
| `execute_code` | Write Python/Perl scripts locally (payload generation, data processing) |
| `kali_shell` | Run local Kali tools (john, searchsploit, linpeas) |
| `execute_curl` | HTTP requests from Kali (probe internal services via pivoting) |

## Direction

Check the original goal and custom instructions first.
If they specify post-exploitation actions, proceed directly.
Only use `action="ask_user"` if the goal does NOT specify what to do after exploitation.

Use `action="ask_user"` before impactful actions: privilege escalation, data exfiltration, persistence, file modifications, lateral movement.
"""


# =============================================================================
# POST-EXPLOITATION TOOLS (Stateless Mode)
# =============================================================================

POST_EXPLOITATION_TOOLS_STATELESS = """
### Post-Exploitation Phase Tools (Stateless Mode)

You are in POST-EXPLOITATION. The exploit works but there is NO persistent session.
Each command requires re-triggering the exploit.

## How to Run Commands on Target

**If you exploited via Metasploit module:**
1. `set CMD "<command>"`
2. `exploit`

**If you exploited via no-module fallback (execute_curl / execute_code / kali_shell):**
Re-run the same tool with the command changed in the payload.

## Direction

Check the original goal and custom instructions first.
If they specify post-exploitation actions, proceed directly.
Only use `action="ask_user"` if the goal does NOT specify what to do after exploitation.

Use `action="ask_user"` before destructive operations (file writes, persistence, data deletion).
"""
